---
layout: post
title: Maintainable Gulp tasks
date: 2016-01-31 11:33:08
categories: writing
number: "04"
---

<p>
Like every front-end dev, I've been working on a lot of automated build projects. Either with Grunt, Gulp or whatever.
</p>
<p>
With each project the main <i>gulpfile.js</i> tends to get a bit of a mess. It gets bloated with tasks, comments and becomes unreadable for whoever opens the file.
</p>
<p>
After a couple of projects dealing with it, I decided to hop on Google and search for some better ways to handle this.
</p>
<p>
    Turns out, a lot of people had similar problems and they found some pretty neat solutions for it. I took the one I liked the most and made a few little adjustments to it. Here's how my new setup looks:
</p>

<img src="/images/posts/gulp-folder-structure.jpg" width="862" height="477">
<p>
    Rather than manage one giant configuration file, each task has been broken down into its own file in <i>gulp/tasks</i>. Any file in that folder gets automatically required by the loop in <i>./gulp/index.js.</i>
</p>
</div>
{% highlight javascript %}


/**
 * ./gulp/index.js
 */

var fs = require('fs'),

    // util to filter all none *.js files to prevent
    // accidental inclusion of possible hidden files
    onlyScripts = require('./util/scriptFilter'),
    getTaskNameByFile = require('./util/getTaskNameByFile'),

    tasksFiles = fs.readdirSync('./gulp/tasks/').filter(onlyScripts);

tasksFiles.forEach(function(taskFile) {

    // basically just gets the filename
    var taskName = getTaskNameByFile(taskFile),
        taskModule = require('./tasks/' + taskFile);

    // each module expects a taskName so it can assign
    // itself to the gulp task list
    taskModule(taskName);
});
{% endhighlight %}
<div class="post__content">
<p>
    To maintain enough flexibility within the tasks/modules I decided to register the task within the module itself.
    So it'll end up looking something like this:
</p>
</div>
{% highlight javascript %}

/**
 * ./gulp/tasks/*.js
 */

var gulp = require('gulp');

module.exports = function(taskName) {

    gulp.task(taskName, function(){ ... });
};
{% endhighlight %}
<div class="post__content">
<p>
    I really like the clear overview of what tasks are available just by looking at the folder structure. There's still
    a lot of room for improvement when it comes to tasks who need to communicate together or need some shared configuration.<br>
    Either way it's a step in a clearer direction.
</p>
